/*!
 * selecty v0.0.1 (https://github.com/undead25/selecty#readme)
 * Copyright 2016 undead25
 * Licensed under the MIT license
 */
!function(){"use strict";var e={addClass:function(e,t){var i=e.className,n=""!==i?" ":"",s=i+n+t;e.className=s},removeClass:function(e,t){var i=" "+e.className+" ";i=i.replace(/(\s+)/gi," ");var n=i.replace(" "+t+" "," ");n=n.replace(/(^\s+)|(\s+$)/g,""),e.className=n},hasClass:function(e,t){var i=e.className,n=i.split(/\s+/),s=0;for(s in n)if(n[s]==t)return!0;return!1},addEvent:function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i},removeEvent:function(e,t,i){e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent?e.detachEvent("on"+t,i):delete e["on"+t]},removeElement:function(e){e&&e.parentNode&&e.parentNode.removeChild(e)},setUid:function(e){do e+=Math.floor(1e6*Math.random());while(document.getElementById(e));return e},clone:function(t){if("object"!=typeof t)return t;if(null===t)return t;var i={};for(var n in t)i[n]=e.clone(t[n]);return i},extend:function(){var e=arguments;if(!(e.length<1)){for(var t=this.clone(e[0]),i=1;i<e.length;i++)for(var n in e[i])t[n]=e[i][n];return t}},eventHandler:function(e){var t=e||window.event,i=t.target||t.srcElement;return{ev:t,target:i}},stopPropagation:function(e){e.stopPropagation?e.stopPropagation():window.event&&(window.event.cancelBubble=!0)}},t=function(i,n){return this instanceof t?(this.settings=e.extend({},this.defaults,n),this.el=i,this.multiple=!1,this.selected=[],this.shown=!1,this.disabled=!1,this.ul=null,this.optionLi=[],this.items=null,this.options=null,this.template='<div class="selecty"><a class="selecty-selected"></a><ul class="selecty-options"></ul></div>',void this.init(i)):new t(i,n)};t.prototype={defaults:{separator:", "},init:function(e){return"string"==typeof e&&"#"===e[0]&&(e=document.getElementById(e.substr(1)),this.el=e),e?e.length<1?void console.error("No options inside <select>"):(null!==this.el.getAttributeNode("multiple")&&(this.multiple=!0),void("SELECT"===e.nodeName&&this.build())):void console.error("Need select element!")},build:function(){this.el.style.display="none",this.options=this.el.querySelectorAll("option"),this.items=this.el.querySelectorAll("option, optgroup"),null!==this.el.getAttributeNode("disabled")&&(this.disabled=!0);var t=document.createElement("div");t.innerHTML=this.template;var i=t.querySelector(".selecty");this.disabled&&e.addClass(i,"disabled"),this.btn=t.querySelector(".selecty-selected"),this.ul=t.querySelector(".selecty-options");for(var n=-1,s=!1,l=0;l<this.items.length;l++){n++;var o=document.createElement("li");"OPTGROUP"===this.items[l].nodeName?(n--,s=!0,o.innerHTML=this.items[l].getAttribute("label"),e.addClass(o,"optgroup")):(o.innerHTML=this.items[l].innerHTML,o.setAttribute("data-value",this.items[l].value),o.setAttribute("data-index",n),s&&e.addClass(o,"optgroup-option"),null!==this.items[l].getAttributeNode("selected")&&(this.selected.push(n),e.addClass(o,"selected")),null!==this.items[l].getAttributeNode("disabled")&&e.addClass(o,"disabled")),this.ul.appendChild(o)}this.optionLi=this.ul.querySelectorAll("li[data-index]"),this.updateSelected(),this.el.parentNode.insertBefore(t.firstChild,this.el.nextSibling),this.events()},events:function(){if(!this.disabled){var t=this;e.addEvent(t.btn,"click",function(n){var s=t.otherActived();null!==s&&e.removeClass(s,"active"),e.stopPropagation(n),t.show(),e.addEvent(document.body,"click",i)});var i=function(n){var s=e.eventHandler(n).target,l=parseInt(s.getAttribute("data-index")),o=e.hasClass(s,"optgroup");if(!o)if("LI"===s.nodeName&&null!==l){if(e.hasClass(s,"disabled"))return;t.multiple?(e.hasClass(s,"selected")?t.selected.splice(t.selected.indexOf(l),1):t.selected.push(l),t.updateSelected()):(t.selected=[],t.selected.push(l),t.updateSelected(),t.hide(),e.removeEvent(document.body,"click",i))}else t.hide(),e.removeEvent(document.body,"click",i)}}},show:function(){e.addClass(this.ul,"active"),this.shown=!0},hide:function(){e.removeClass(this.ul,"active"),e.removeEvent(document.body,"click",function(e){}),this.shown=!1},otherActived:function(){for(var t=document.body.querySelectorAll(".selecty-options"),i=0;i<t.length;i++)if(e.hasClass(t[i],"active"))return t[i];return null},updateSelected:function(){this.clearSelected(),this.btn.innerHTML="",this.selected.sort(function(e,t){return e-t});for(var t=0;t<this.selected.length;t++){var i=this.selected[t];if(this.options[i].setAttribute("selected","selected"),e.addClass(this.optionLi[i],"selected"),this.multiple){var n=this.settings.separator;""===this.btn.innerHTML&&(n=""),this.btn.innerHTML+=n+this.options[i].innerHTML}else this.btn.innerHTML=this.options[i].innerHTML}""===this.btn.innerHTML&&(this.btn.innerHTML=this.options[0].innerHTML)},clearSelected:function(){for(var t=0;t<this.options.length;t++)this.options[t].removeAttribute("selected"),e.removeClass(this.optionLi[t],"selected")}},"undefined"!=typeof module&&module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define([],function(){return t}):window.selecty=t;var i=window.jQuery;void 0!==i&&(i.fn.selecty=function(){var e=Array.prototype.slice.call(arguments);return i(this).each(function(){e[0]&&"object"!=typeof e[0]?"string"==typeof e[0]&&t.prototype[e[0]].apply(new t(this),e.slice(1)):new t(this,e[0]||{})})})}();